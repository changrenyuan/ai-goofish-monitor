# 单个商品链接快速分析指南

## 📖 功能说明

使用与项目相同的AI分析工具，对单个闲鱼商品链接进行深度分析，包括：
- 商品信息完整采集
- 卖家行为画像构建
- 多维度风险识别
- AI智能推荐决策

## 🚀 快速使用

### Windows 用户

```cmd
# 基本用法
analyze_link.bat https://www.goofish.com/item/i123456789

# 指定分析标准
analyze_link.bat https://www.goofish.com/item/i123456789 prompts/macbook_criteria.txt
```

### Mac/Linux 用户

```bash
# 基本用法
python analyze_single.py https://www.goofish.com/item/i123456789

# 指定分析标准
python analyze_single.py https://www.goofish.com/item/i123456789 prompts/macbook_criteria.txt
```

## 📋 使用步骤

### 1. 准备工作

确保以下配置已完成：

✅ **AI配置**
- `.env` 文件已配置 `OPENAI_API_KEY` 和 `OPENAI_BASE_URL`
- 当前已配置为通义千问（qwen-plus）

✅ **登录状态**
- `state/` 目录下有有效的登录状态JSON文件
- 或已设置 `STATE_FILE` 环境变量

✅ **分析标准文件**
- `prompts/macbook_criteria.txt` （MacBook分析标准）
- 或自定义的分析标准文件

### 2. 运行分析

以 MacBook 商品为例：

```cmd
analyze_link.bat https://www.goofish.com/item/i7417304756607258292
```

### 3. 查看结果

分析过程会实时显示：

```
================================================================================
  步骤 1: 验证URL并提取商品ID
================================================================================

✅ 商品ID: i7417304756607258292

================================================================================
  步骤 2: 检查登录状态
================================================================================

✅ 登录状态文件: state/acc1.json

================================================================================
  步骤 3: 加载AI分析标准
================================================================================

✅ 分析标准加载成功: prompts/macbook_criteria.txt
   Prompt长度: 5234 字符

================================================================================
  步骤 4: 初始化AI客户端
================================================================================

✅ AI客户端已就绪
   模型: qwen-plus
   API地址: https://dashscope.aliyuncs.com/compatible-mode/v1

================================================================================
  步骤 5: 启动浏览器并获取商品数据
================================================================================

📱 正在访问商品页面: https://www.goofish.com/item/i7417304756607258292
✅ 成功获取商品详情API响应

================================================================================
  步骤 6: 解析商品信息
================================================================================

✅ 商品图片: 8 张
📦 商品标题: 自用转手MacBook Air M1芯片 16G+256G
💰 当前售价: ¥5200
🎯 想要人数: 12
👀 浏览量: 156
📍 发货地区: 上海

================================================================================
  步骤 7: 采集卖家信息
================================================================================

👤 卖家ID: 123456789
🔄 正在采集卖家完整信息...
✅ 卖家信息采集完成
   卖家昵称: 数码爱好者小王
   卖家信用: 极好
   在售商品: 12/50

================================================================================
  步骤 8: 下载商品图片
================================================================================

✅ 成功下载 8 张图片

================================================================================
  步骤 9: AI深度分析
================================================================================

🤖 正在调用AI分析商品...
   (这可能需要30-60秒，请耐心等待...)
✅ AI分析完成!

================================================================================
  📊 AI分析结果
================================================================================

✅ 是否推荐: 是 ✅

💬 推荐理由:
   这是一个可信的个人卖家，商品成色良好，价格合理，推荐购买

⚠️  风险标签: ["电池健康度需确认"]

👤 卖家画像:
   类型: PERSONAL_PLAYER
   详细: 顶级个人玩家

   综合评价:
   • 该卖家行为逻辑链完整，买卖记录连贯
   • 商品多为个人升级换代，符合发烧友特征
   • 评价反馈真实可信

   行为逻辑链:
   该卖家的行为逻辑链完整：早期购买游戏，中期购入相机和镜头，近期开始出售旧款电子设备。这是一个典型的数码产品消费者的成长路径，可信度极高。
   证据: 购买记录横跨数年，间隔期长，符合个人卖家特征

================================================================================
  🎉 决策建议: 推荐购买!
================================================================================
```

### 4. 查看完整数据

分析结果会自动保存到 `single_analysis_results/analysis_YYYYMMDD_HHMMSS.json`

可以用任何JSON查看器或文本编辑器打开查看完整数据。

## 🎯 分析维度说明

AI分析包含以下7个维度：

| 维度 | 说明 | 硬性条件 |
|------|------|---------|
| **model_chip** | 型号/芯片 | 必须符合要求 |
| **battery_health** | 电池健康度 | ≥90%（如有数据） |
| **condition** | 成色外观 | 最多接受细微划痕 |
| **history** | 机器历史 | 不得有维修记录 |
| **seller_type** | 卖家类型 | 核心判断维度 |
| **shipping** | 邮寄方式 | 必须支持邮寄 |
| **seller_credit** | 卖家信用 | 必须是"极好" |

## 🔍 卖家画像识别（核心）

AI会通过以下信息构建卖家行为画像：

### ✅ 个人玩家特征
- 交易时间跨度长（数年）
- 买卖行为形成"体验-升级-出售"逻辑闭环
- 购买记录显示为个人消费品
- 售卖商品种类分散

### ❌ 商家/贩子特征
- 短期内密集交易
- 购买维修配件、坏机
- 高度集中同型号商品
- 出现"同行、工作室、拿货"等术语
- 行为逻辑链断裂

### 🎯 关键判断

AI不仅看孤立的信号，而是**构建完整的卖家行为故事**：

```
✅ 可信故事:
2021年买游戏 → 2022年买相机 → 2023年买MacBook
→ 2024年卖旧MacBook（升级M2）
= 数码发烧友的成长路径

❌ 不可信故事:
购买大量维修配件 + 坏机
→ 售卖大量"几乎全新"的MacBook
= 商家伪装个人卖家
```

## 📊 结果解读

### 推荐状态

| 状态 | 说明 |
|------|------|
| ✅ **推荐购买** | 卖家可信，商品符合要求 |
| ❌ **不推荐** | 存在硬性否决项或商家风险 |
| ⚠️ **有条件推荐** | 需要手动确认某些信息（如电池健康度） |

### 风险标签

- `battery_health`: 电池健康度需确认
- `condition`: 成色需进一步确认
- `seller_type`: 卖家类型存疑
- `history`: 维修历史不明
- `shipping`: 邮寄方式有风险

### 决策建议

根据AI分析的 `is_recommended` 字段：

- `true`: 推荐购买
- `false`: 不建议购买，需谨慎

## ⚙️ 自定义分析标准

如果想分析其他商品（如iPhone、iPad、相机等），可以：

### 方法1: 手动创建标准文件

复制 `prompts/macbook_criteria.txt`，修改为新的标准：

```bash
copy prompts\macbook_criteria.txt prompts\iphone_criteria.txt
# 然后编辑 iphone_criteria.txt 修改具体要求
```

### 方法2: 使用AI生成标准

```bash
python src/prompt_utils.py
# 按提示输入需求，AI会自动生成新的分析标准
```

然后使用新标准分析：

```bash
analyze_link.bat https://www.goofish.com/item/i123456 prompts/iphone_criteria.txt
```

## ❓ 常见问题

### Q1: 提示"未找到登录状态文件"

**A**: 确保以下位置之一存在登录状态JSON文件：
- `state/acc1.json`
- 或设置 `STATE_FILE` 环境变量指向你的登录文件

### Q2: AI分析失败

**A**: 检查：
- `.env` 文件中的 `OPENAI_API_KEY` 是否正确
- 网络连接是否正常
- API是否支持图片上传

### Q3: 分析速度很慢

**A**: 正常情况，因为需要：
- 采集完整卖家信息（需要滚动加载）
- 下载所有商品图片
- AI深度分析（通常30-60秒）

### Q4: 可以同时分析多个链接吗？

**A**: 暂不支持，一次只能分析一个链接。如需批量分析，建议创建监控任务。

### Q5: 分析结果会保存吗？

**A**: 会自动保存到 `single_analysis_results/analysis_YYYYMMDD_HHMMSS.json`

## 🎓 进阶使用

### 查看原始数据

分析结果JSON包含：

```json
{
  "爬取时间": "2024-01-01T10:00:00",
  "商品信息": {
    "商品ID": "i7417304756607258292",
    "商品标题": "...",
    "当前售价": "¥5200",
    ""想要"人数": "12",
    "浏览量": "156",
    "商品图片列表": ["url1", "url2", ...],
    "商品主图链接": "url1"
  },
  "卖家信息": {
    "卖家昵称": "...",
    "卖家信用等级": "极好",
    "卖家芝麻信用": "极好",
    "卖家在售/已售商品数": "12/50",
    "卖家发布的商品列表": [...],
    "卖家收到的评价列表": [...],
    "作为卖家的好评数": "45/50",
    "作为卖家的好评率": "90.00%",
    "作为买家的好评数": "30/35",
    "作为买家的好评率": "85.71%"
  },
  "ai_analysis": {
    "prompt_version": "EagleEye-V6.4",
    "is_recommended": true,
    "reason": "...",
    "risk_tags": [...],
    "criteria_analysis": {
      "model_chip": {...},
      "battery_health": {...},
      "condition": {...},
      "history": {...},
      "seller_type": {...},
      "shipping": {...},
      "seller_credit": {...}
    }
  }
}
```

### 手动查看卖家行为链

重点查看 `seller_info` 中的：
- `卖家发布的商品列表`: 卖家在售/已售商品
- `卖家收到的评价列表`: 所有历史评价
- `as_seller_*`: 作为卖家/买家的好评率

这些数据构建了完整的卖家行为画像！

---

**现在就试试吧！把你想分析的闲鱼链接告诉我！** 🔥
