# 新建任务指南

## 方式一：使用 Web 界面（推荐）

### 步骤 1：登录
1. 打开浏览器访问：`http://localhost:5000`
2. 输入用户名和密码：
   - 用户名：`admin`
   - 密码：`admin123`

### 步骤 2：创建 AI 任务
在任务管理页面，点击 **"AI 生成任务"** 按钮，填写以下信息：

#### 示例 1：监控 iPhone 15

**基本信息：**
- **任务名称**：`iPhone 15 监控`
- **关键词**：`iPhone 15`
- **描述（自然语言）**：
  ```
  寻找 iPhone 15，要求：
  - 成色全新或99新，无明显划痕
  - 电池健康90%以上
  - 价格区间 3500-4500 元
  - 原装正品，无维修历史
  - 仅限个人卖家，排除商家和贩子
  ```
- **价格范围**：
  - 最低价格：`3500`
  - 最高价格：`4500`
- **其他设置**：
  - 仅看个人：`✓`（勾选）
  - 最大页数：`3`
  - 定时任务：留空（不使用定时）

**点击"生成任务"按钮**，系统会自动：
1. 调用 AI 根据描述生成分析标准
2. 保存到 `prompts/iphone_15_criteria.txt`
3. 创建任务并保存到配置文件

#### 示例 2：监控 Apple Watch S10

**基本信息：**
- **任务名称**：`Apple Watch S10 监控`
- **关键词**：`Apple Watch S10`
- **描述（自然语言）**：
  ```
  寻找 Apple Watch Series 10，要求：
  - 成色新，包装齐全
  - 无拆无修，功能正常
  - 价格 2000-3000 元
  - 原版表带和充电器
  - 排除翻新机和官换机
  ```
- **价格范围**：
  - 最低价格：`2000`
  - 最高价格：`3000`
- **其他设置**：
  - 仅看个人：`✓`（勾选）
  - 最大页数：`3`

#### 示例 3：监控 Nintendo Switch

**基本信息：**
- **任务名称**：`Switch OLED 监控`
- **关键词**：`Switch OLED`
- **描述（自然语言）**：
  ```
  寻找 Switch OLED 主机，要求：
  - 国行或日行版本
  - 成色9新以上
  - 使用时间短，电池健康
  - 价格 1500-2200 元
  - 包含原装底座和Joy-Con
  - 无漂移，手柄完好
  ```
- **价格范围**：
  - 最低价格：`1500`
  - 最高价格：`2200`
- **其他设置**：
  - 仅看个人：`✓`（勾选）
  - 最大页数：`5`

### 步骤 3：启动任务
任务创建成功后，在任务列表中点击 **"启动"** 按钮，任务开始运行。

### 步骤 4：查看结果
点击 **"结果"** 标签页，可以查看：
- AI 分析的商品列表
- 推荐理由
- 卖家画像分析
- 商品截图

---

## 方式二：手动创建任务

如果你不想使用 AI 生成，可以手动创建任务：

### 1. 准备 Prompt 文件

创建 `prompts/your_product_criteria.txt`，参考 `prompts/macbook_criteria.txt` 的格式：

```text
### **第一部分：核心分析原则 (不可违背)**

1. **一票否决硬性原则**:
   - 必须是 [你的产品名称和型号]
   - 成色要求：[如 9新以上]
   - 价格范围：[如 500-1000元]
   - 电池/使用情况：[如 90%以上]

2. **卖家类型判断**:
   - 排除商家和贩子
   - 优先个人玩家
   - 留意危险信号（批量售卖、专业描述等）

### **第二部分：详细分析指南**

[更多详细规则...]
```

### 2. 使用 API 创建任务

```bash
curl -X POST http://localhost:5000/api/tasks \
  -H "Content-Type: application/json" \
  -H "Authorization: Basic YWRtaW46YWRtaW4xMjM=" \
  -d '{
    "task_name": "你的任务名称",
    "enabled": true,
    "keyword": "搜索关键词",
    "description": "任务描述",
    "max_pages": 3,
    "personal_only": true,
    "min_price": "500",
    "max_price": "1000",
    "ai_prompt_base_file": "prompts/base_prompt.txt",
    "ai_prompt_criteria_file": "prompts/your_product_criteria.txt"
  }'
```

---

## 任务配置说明

| 字段 | 说明 | 示例 |
|------|------|------|
| 任务名称 | 任务标识，易于识别 | `iPhone 15 监控` |
| 关键词 | 闲鱼搜索关键词 | `iPhone 15`、`MacBook Air M1` |
| 描述 | 自然语言描述你的需求，AI 会据此生成分析标准 | `成色9新，电池90%以上` |
| 仅看个人 | 是否只显示个人卖家 | 勾选 |
| 最低价格 | 商品价格下限 | `1000` |
| 最高价格 | 商品价格上限 | `5000` |
| 最大页数 | 扫描闲鱼的页数 | `3`（每页约 20 个商品） |
| 定时任务 | Cron 表达式，定时运行任务 | `0 */2 * * *`（每2小时） |
| 账号文件 | 指定使用的闲鱼账号状态文件 | `xianyu_state.json` |

---

## 定时任务示例

| Cron 表达式 | 说明 |
|------------|------|
| `0 */2 * * *` | 每2小时运行一次 |
| `0 9,15,21 * * *` | 每天 9:00、15:00、21:00 运行 |
| `0 10 * * 1-5` | 工作日 10:00 运行 |
| `*/30 * * * *` | 每30分钟运行一次 |

---

## AI 描述写作技巧

写好描述是 AI 准确分析的关键：

### ✅ 好的描述

```
寻找 MacBook Air M1，要求：
- 256GB 或更高容量
- 成色9新以上，无明显划痕
- 电池健康90%以上
- 原装无维修历史
- 价格区间 3500-4500元
- 仅限个人卖家，排除商家
- 包装齐全（充电器、数据线）
```

### ❌ 不好的描述

```
MacBook Air M1便宜点
```

### 描述应该包含：

1. **产品明确性**：
   - 具体型号：`iPhone 15 Pro Max` 而不是 `iPhone`
   - 容量规格：`256GB`、`512GB`
   - 版本信息：`国行`、`日行`、`港版`

2. **成色要求**：
   - `全新`、`99新`、`95新`、`9新`
   - `无明显划痕`、`无磕碰`
   - `屏幕完美`、`边框完好`

3. **功能状态**：
   - 电池健康度
   - 无拆无修
   - 功能正常
   - 无暗病

4. **价格区间**：
   - 明确的最低和最高价格
   - 市场价格的合理区间

5. **配件要求**：
   - 包装盒
   - 充电器
   - 原装配件
   - 购买凭证

6. **卖家要求**：
   - 仅限个人
   - 排除商家
   - 交易记录良好

---

## 常见问题

### Q: 如何修改已创建的任务？

A: 在任务列表中点击任务卡片，然后点击编辑按钮，修改后保存。

### Q: AI 生成的分析标准不满意怎么办？

A: 可以手动编辑 `prompts/` 目录下对应的 `*_criteria.txt` 文件，修改分析规则。

### Q: 任务运行后没有找到商品？

A: 可能原因：
1. 关键词搜索结果为空
2. 价格区间设置不合理
3. 成色要求过高
4. 页数扫描太少

### Q: 如何停止任务？

A: 在任务列表中点击任务的"停止"按钮。

### Q: 定时任务如何配置？

A: 在创建/编辑任务时，填写 Cron 表达式即可。参考上方的定时任务示例。
